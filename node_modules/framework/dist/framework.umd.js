((e,t)=>{'object'==typeof exports&&'undefined'!=typeof module?t(exports,require('@loadable/component'),require('react-router-config'),require('effector'),require('patronum'),require('history')):'function'==typeof define&&define.amd?define(['exports','@loadable/component','react-router-config','effector','patronum','history'],t):t((e='undefined'!=typeof globalThis?globalThis:e||self).framework={},e.loadable,e.ReactRouterConfig,e.effector,e.patronum,e.History)})(this,((e,t,r,effector,a,o)=>{function n(e){return e&&'object'==typeof e&&'default'in e?e:{default:e}}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((t=>Object.getOwnPropertyDescriptor(e,t).enumerable))),r.push.apply(r,a)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),1).forEach((t=>{s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((t=>{Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:1,configurable:1,writable:1}):e[t]=r,e}function d(e){return e[m]}var u=n(t);const f=effector.createDomain('framework/default',{name:"defaultDomain",sid:"-tzcbvc"}),m='framework/page-hatch';Object.defineProperty(e,'loadable',{enumerable:1,get:()=>u.default}),e.contract=e=>{for(const t in e.page){const r=e.page[t],a=e.model[t];r&&a&&effector.is.unit(r)&&effector.is.unit(a)&&(effector.is.store(r,{sid:"xrdgy2"})&&effector.is.store(a,{sid:"xrdih6"})?(effector.forward({and:{from:a,to:r},or:{sid:"m1otzj"}}),r.defaultState=a.defaultState,r.stateRef.current=a.stateRef.current,r.stateRef.before=[{type:'map',fn:e=>e,from:a.stateRef}]):effector.forward({and:{from:r,to:a},or:{sid:"n1fgk0"}}))}},e.createBrowserApplication=e=>{const t=e.domain||f,n=((e,{emitHistory:t=0,trackRedirects:r=0}={})=>{const a='undefined'!=typeof document?o.createBrowserHistory():o.createMemoryHistory(),n=e.createEffect((()=>{}),{name:"historyPush",sid:"ph1zyv"}),i=e.createEffect((()=>{}),{name:"historyPushSearch",sid:"yxzraw"}),c=e.createEffect((()=>{}),{name:"historyReplace",sid:"-pcfgpo"}),s=e.createEvent({name:"historyChanged",sid:"-yqk2kz"}),d=e.createEvent({name:"historyEmitCurrent",sid:"nhk4d5"}),u=e.createStore('',{name:"$redirectTo",sid:"581zmv"});return effector.sample({and:[{clock:d,fn:()=>({action:'REPLACE',hash:a.location.hash,pathname:a.location.pathname,search:a.location.search}),target:s}],or:{sid:"km8cdb"}}),t&&(n.use((e=>a.push(e))),c.use((e=>a.replace(e))),i.use((e=>a.push({search:e}))),d.watch((()=>{let e;try{e=effector.scopeBind(s)}catch(t){e=e=>s(e)}a.listen((({pathname:t,search:r,hash:a},o)=>{e({pathname:t,search:r,hash:a,action:o})}))}))),r&&(u.on([n,c],((e,t)=>t)),t&&u.on(s,((e,{pathname:t,search:r})=>`${t}?${r}`))),{history:a,historyPush:n,historyPushSearch:i,historyReplace:c,historyChanged:s,historyEmitCurrent:d,$redirectTo:u}})(t,{emitHistory:1});effector.forward({and:{from:e.ready,to:n.historyEmitCurrent},or:{sid:"-yp3wn8"}});const i=n.historyChanged.filterMap((t=>{const a=r.matchRoutes(e.routes,t.pathname);if(a.length>0)return c(c({},a[0]),{},{change:t})}));for(const{component:r,path:o}of e.routes){if(!r)continue;if(r.load)throw new Error(`[${o}] lazy components temporary is not supported. Please, remove loadable() call`);const{routeMatched:e,__:n}=a.splitMap({source:i,cases:{routeMatched:({route:e,match:t,change:r})=>{if(e.path===o)return{params:t.params,query:Object.fromEntries(new URLSearchParams(r.search))}}}}),c=t.createEvent({name:`hatchEnter:${o}`},{name:"hatchEnter",sid:"-e9ffs9"}),s=t.createEvent({name:`hatchUpdate:${o}`},{name:"hatchUpdate",sid:"y0vldw"}),u=t.createEvent({name:`hatchExit:${o}`},{name:"hatchExit",sid:"-733nio"}),f=d(r);f&&(effector.forward({and:{from:c,to:f.enter},or:{sid:"-we2yy9"}}),effector.forward({and:{from:s,to:f.update},or:{sid:"-wdj6cw"}}),effector.forward({and:{from:u,to:f.exit},or:{sid:"-wczdrj"}}));const m=t.createStore(0,{and:{name:`$onRoute:${o}`},name:"$onRoute",sid:"ly7iyy"}),h=t.createStore(0,{and:{name:`$onPage:${o}`},name:"$onPage",sid:"kdm6x2"});m.on(e,(()=>1)),effector.guard({and:[{clock:e,filter:h,target:s}],or:{sid:"-vuadmz"}}),effector.guard({and:[{clock:e,filter:effector.combine({and:[h,m,(e,t)=>!e&&t],or:{name:"filter",sid:"8acmah"}}),target:c}],or:{sid:"-vffxm8"}}),h.on(c,(()=>1)),m.on(n,(()=>0)),effector.guard({and:[{clock:n,filter:h,target:u}],or:{sid:"-uxaq1b"}}),h.on(u,(()=>0))}return{navigation:n}},e.createHatch=(e=f)=>{var t,r,a;let o,n;effector.is.domain(e,{sid:"d6uzry"})?(o=e,n={}):effector.is.domain(e.domain,{sid:"-fuus8v"})?(o=e.domain,n=e):(o=f,n={});const i=o.createStore(Boolean(0),{name:"$opened",sid:"nsf3zm"}),c=o.createStore({},{name:"$params",sid:"7jlluc"}),s=o.createStore({},{name:"$query",sid:"-h3y3q"}),d={enter:null!==(t=n.enter)&&void 0!==t?t:o.createEvent({name:"enter",sid:"-hoeep"}),update:null!==(r=n.update)&&void 0!==r?r:o.createEvent({name:"update",sid:"-e6k2lh"}),exit:null!==(a=n.exit)&&void 0!==a?a:o.createEvent({name:"exit",sid:"36qrk9"}),$opened:i,$params:c,$query:s,$props:effector.combine({and:[{params:c,query:s}],or:{name:"$props",sid:"-kba9zb"}})};return c.on([d.enter,d.update],((e,{params:t})=>t)),s.on([d.enter,d.update],((e,{query:t})=>t)),d.$opened.on(d.enter,(()=>Boolean(1))).reset(d.exit),d},e.createPages=e=>r.renderRoutes(e),e.getHatch=d,e.lookupHatch=e=>{if(e.route.component)return d(e.route.component)},e.withHatch=(e,t)=>(t[m]=e,t),Object.defineProperty(e,'__esModule',{value:1})}));
//# sourceMappingURL=framework.umd.js.map
